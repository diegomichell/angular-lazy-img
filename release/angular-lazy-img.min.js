angular.module("angularLazyImg",[]),angular.module("angularLazyImg").factory("LazyImgMagic",["$window","$rootScope","lazyImgConfig","lazyImgHelpers",function(n,e,t,o){"use strict";function i(){for(var n=y.length-1;n>=0;n--){var e=y[n],t=e.$elem.is&&e.$elem.is(":visible");e&&t&&o.isElementInView(e.$elem[0],I.offset,h)&&(u(e),y.splice(n,1))}0===y.length&&s()}function r(n){z.forEach(function(e){e[n]("scroll",C),e[n]("touchmove",C)}),d[n]("resize",C),d[n]("resize",v)}function c(){p=!0,setTimeout(function(){i(),r("on"),g(n.document.body,C),z.forEach(function(n){g(n[0],C)})},1)}function s(){p=!1,r("off"),m(n.document.body),z.forEach(function(n){m(n[0])})}function a(n){var e=y.indexOf(n);-1!==e&&y.splice(e,1)}function u(n){var t=new Image;t.onerror=function(){I.errorClass&&n.$elem.addClass(I.errorClass),e.$emit("lazyImg:error",n),I.onError(n)},t.onload=function(){l(n.$elem,n.src),I.successClass&&n.$elem.addClass(I.successClass),e.$emit("lazyImg:success",n),I.onSuccess(n)},t.src=n.src}function l(n,e){"img"===n[0].nodeName.toLowerCase()?n[0].src=e:n.css("background-image",'url("'+e+'")')}function g(n,e){var t,o=n.clientHeight;!function i(){t=n.clientHeight,o!=t&&e(),o=t,n.onHeightChangeTimer&&clearTimeout(n.onHeightChangeTimer),n.onHeightChangeTimer=setTimeout(i,200)}()}function m(n){clearTimeout(n.onHeightChangeTimer),delete n.onHeightChangeTimer}function f(n){this.$elem=n}var h,d,y,p,I,C,v,z;return y=[],p=!1,I=t.getOptions(),d=angular.element(n),h=o.getWinDimensions(),v=o.throttle(function(){h=o.getWinDimensions()},60),z=[I.container||d],C=o.throttle(i,30),f.prototype.setSource=function(n){this.src=n,y.unshift(this),p||c()},f.prototype.removeImage=function(){a(this),0===y.length&&s()},f.prototype.checkImages=function(){i()},f.addContainer=function(n){s(),z.push(n),c()},f.removeContainer=function(n){s(),z.splice(z.indexOf(n),1),c()},f}]),angular.module("angularLazyImg").provider("lazyImgConfig",function(){"use strict";this.options={offset:100,errorClass:null,successClass:null,onError:function(){},onSuccess:function(){}},this.$get=function(){var n=this.options;return{getOptions:function(){return n}}},this.setOptions=function(n){angular.extend(this.options,n)}}),angular.module("angularLazyImg").factory("lazyImgHelpers",["$window",function(n){"use strict";function e(){return{height:n.innerHeight,width:n.innerWidth}}function t(n,e,t){var o=n.getBoundingClientRect(),i=t.height+e;return o.left>=0&&o.right<=t.width+e&&(o.top>=0&&o.top<=i||o.bottom<=i&&o.bottom>=0-e)}function o(n,e,t){var o,i;return function(){var r=t||this,c=+new Date,s=arguments;o&&o+e>c?(clearTimeout(i),i=setTimeout(function(){o=c,n.apply(r,s)},e)):(o=c,n.apply(r,s))}}return{isElementInView:t,getWinDimensions:e,throttle:o}}]),angular.module("angularLazyImg").directive("lazyImg",["$rootScope","LazyImgMagic",function(n,e){"use strict";function t(t,o,i){var r=new e(o);i.$observe("lazyImg",function(n){n&&r.setSource(n)}),t.$on("$destroy",function(){r.removeImage()}),n.$on("lazyImg.runCheck",function(){r.checkImages()}),n.$on("lazyImg:refresh",function(){r.checkImages()})}return{link:t,restrict:"A"}}]).directive("lazyImgContainer",["LazyImgMagic",function(n){"use strict";function e(e,t){n.addContainer(t),e.$on("$destroy",function(){n.removeContainer(t)})}return{link:e,restrict:"A"}}]);